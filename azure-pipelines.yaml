trigger:
  branches:
    include:
      - "main"

pool:
  name: "planet-express-docker-agents"

variables:
- name: usecache
  value: "true"

steps:
- task: Docker@2
  inputs:
    containerRegistry: 'DG Modules Container Registry'
    command: 'login'
    addPipelineData: false
  displayName: 'Login to docker registry for build'
- script: ./build.sh $(Build.SourceBranchName) $(Build.SourceVersion) $(usecache) 
  workingDirectory: ./build/
  name: buildThinClient
  displayName: 'Build Squashfs'
- task: Docker@2
  inputs:
    containerRegistry: 'DG Modules Container Registry'
    repository: 'planetexpress/thinclient-base:21.04'
    command: 'push'
    Dockerfile: '.'
    buildContext: '.'
    tags: 'latest'

